---

title: inference.export

keywords: fastai
sidebar: home_sidebar

summary: "This module contains the main functionality for extracting the transform parameters from DataLoaders"
description: "This module contains the main functionality for extracting the transform parameters from DataLoaders"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/00b_inference.export.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Vision">Vision<a class="anchor-link" href="#Vision"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For an example we will look at the pets dataset. We will define a series of transforms in our Pipelines, and we will attempt to extract them.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">untar_data</span><span class="p">(</span><span class="n">URLs</span><span class="o">.</span><span class="n">PETS</span><span class="p">)</span>
<span class="n">fnames</span> <span class="o">=</span> <span class="n">get_image_files</span><span class="p">(</span><span class="n">path</span><span class="o">/</span><span class="s1">&#39;images&#39;</span><span class="p">)</span>
<span class="n">pat</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;(.+)_\d+.jpg$&#39;</span>
<span class="n">batch_tfms</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">aug_transforms</span><span class="p">(),</span> <span class="n">Normalize</span><span class="o">.</span><span class="n">from_stats</span><span class="p">(</span><span class="o">*</span><span class="n">imagenet_stats</span><span class="p">)]</span>
<span class="n">item_tfms</span> <span class="o">=</span> <span class="n">RandomResizedCrop</span><span class="p">(</span><span class="mi">460</span><span class="p">,</span> <span class="n">min_scale</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span><span class="mf">1.</span><span class="p">))</span>
<span class="n">bs</span><span class="o">=</span><span class="mi">64</span>
<span class="n">dls</span> <span class="o">=</span> <span class="n">ImageDataLoaders</span><span class="o">.</span><span class="n">from_name_re</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">fnames</span><span class="p">,</span> <span class="n">pat</span><span class="p">,</span> <span class="n">batch_tfms</span><span class="o">=</span><span class="n">batch_tfms</span><span class="p">,</span> 
                                   <span class="n">item_tfms</span><span class="o">=</span><span class="n">item_tfms</span><span class="p">,</span> <span class="n">bs</span><span class="o">=</span><span class="n">bs</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">to_list</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
    <span class="s2">&quot;Recursively make any `L()` or CategoryMap to list&quot;</span>
    <span class="k">def</span> <span class="nf">_inner</span><span class="p">(</span><span class="n">o</span><span class="p">):</span> 
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span><span class="n">L</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">CategoryMap</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">to_detach</span><span class="p">(</span><span class="n">o</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">o</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">b</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">b</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">apply</span><span class="p">(</span><span class="n">_inner</span><span class="p">,</span><span class="n">b</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">b</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls</span><span class="o">.</span><span class="n">after_batch</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">fs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="vm">__dict__</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;max_lighting&#39;: 0.2,
 &#39;p&#39;: 0.75,
 &#39;draw&#39;: None,
 &#39;batch&#39;: False,
 &#39;change&#39;: tensor([1.0732], device=&#39;cuda:0&#39;)}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">_make_tfm_dict</span><span class="p">(</span><span class="n">dls</span><span class="o">.</span><span class="n">after_item</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;RandomResizedCrop&#39;: {&#39;size&#39;: (460, 460),
  &#39;min_scale&#39;: 0.75,
  &#39;ratio&#39;: (1.0, 1.0),
  &#39;val_xtra&#39;: 0.14}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls</span><span class="o">.</span><span class="n">after_batch</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">fs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="vm">__dict__</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;max_lighting&#39;: 0.2,
 &#39;p&#39;: 0.75,
 &#39;draw&#39;: None,
 &#39;batch&#39;: False,
 &#39;change&#39;: tensor([1.0732], device=&#39;cuda:0&#39;)}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">my_d</span> <span class="o">=</span> <span class="n">dls</span><span class="o">.</span><span class="n">after_batch</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">fs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">my_d</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;max_lighting&#39;: 0.2,
 &#39;p&#39;: 0.75,
 &#39;draw&#39;: None,
 &#39;batch&#39;: False,
 &#39;change&#39;: TensorImage([0.5723], device=&#39;cuda:0&#39;)}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">fastai2.vision.augment</span> <span class="kn">import</span> <span class="n">_BrightnessLogit</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>RandTransform<span class="o">??</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">extract_logits</span><span class="p">(</span><span class="n">tfm</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">tfm</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">name</span>
    <span class="n">t_d</span> <span class="o">=</span> <span class="n">tfm</span><span class="o">.</span><span class="vm">__dict__</span>
    <span class="n">t</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(#2) [&lt;fastai2.vision.augment._BrightnessLogit object at 0x7f77c6232f90&gt;,&lt;fastai2.vision.augment._ContrastLogit object at 0x7f77c6232e90&gt;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls</span><span class="o">.</span><span class="n">after_batch</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">fs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;_BrightnessLogit&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ab_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">tfm</span> <span class="ow">in</span> <span class="n">dls</span><span class="o">.</span><span class="n">after_batch</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tfm</span><span class="p">,</span> <span class="n">AffineCoordTfm</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tfm</span><span class="p">,</span> <span class="n">LightingTfm</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tfm</span><span class="p">,</span> <span class="s1">&#39;aff_fs&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tfm</span><span class="o">.</span><span class="n">aff_fs</span><span class="p">:</span>
                <span class="n">ab_dict</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">keywords</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tfm</span><span class="p">,</span> <span class="s1">&#39;coord_fs&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tfm</span><span class="o">.</span><span class="n">coord_fs</span><span class="p">:</span>
                <span class="n">t_d</span><span class="p">,</span><span class="n">n</span> <span class="o">=</span> <span class="n">_gen_dict</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                <span class="n">ab_dict</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">t_d</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tfm</span><span class="p">,</span> <span class="s1">&#39;fs&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tfm</span><span class="o">.</span><span class="n">fs</span><span class="p">:</span>
                <span class="n">t_d</span><span class="p">,</span><span class="n">n</span> <span class="o">=</span> <span class="n">_gen_dict</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>here
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_information" class="doc_header"><code>get_information</code><a href="https://github.com/muellerzr/fastinference/tree/master/fastinference/inference/export.py#L47" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_information</code>(<strong><code>dls</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="get_information">get_information<a class="anchor-link" href="#get_information"> </a></h3><p>This function will take any set of <code>DataLoaders</code> and extract the transforms which are important during inference and their information</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tfm_info</span> <span class="o">=</span> <span class="n">get_information</span><span class="p">(</span><span class="n">dls</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For vision it will contain <code>tfms</code>, <code>after_item</code>, and <code>after_batch</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>First, our <code>type</code> transforms:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tfm_info</span><span class="p">[</span><span class="s1">&#39;tfms&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;Categorize&#39;: {&#39;vocab&#39;: [&#39;Abyssinian&#39;,
   &#39;Bengal&#39;,
   &#39;Birman&#39;,
   &#39;Bombay&#39;,
   &#39;British_Shorthair&#39;,
   &#39;Egyptian_Mau&#39;,
   &#39;Maine_Coon&#39;,
   &#39;Persian&#39;,
   &#39;Ragdoll&#39;,
   &#39;Russian_Blue&#39;,
   &#39;Siamese&#39;,
   &#39;Sphynx&#39;,
   &#39;american_bulldog&#39;,
   &#39;american_pit_bull_terrier&#39;,
   &#39;basset_hound&#39;,
   &#39;beagle&#39;,
   &#39;boxer&#39;,
   &#39;chihuahua&#39;,
   &#39;english_cocker_spaniel&#39;,
   &#39;english_setter&#39;,
   &#39;german_shorthaired&#39;,
   &#39;great_pyrenees&#39;,
   &#39;havanese&#39;,
   &#39;japanese_chin&#39;,
   &#39;keeshond&#39;,
   &#39;leonberger&#39;,
   &#39;miniature_pinscher&#39;,
   &#39;newfoundland&#39;,
   &#39;pomeranian&#39;,
   &#39;pug&#39;,
   &#39;saint_bernard&#39;,
   &#39;samoyed&#39;,
   &#39;scottish_terrier&#39;,
   &#39;shiba_inu&#39;,
   &#39;staffordshire_bull_terrier&#39;,
   &#39;wheaten_terrier&#39;,
   &#39;yorkshire_terrier&#39;],
  &#39;add_na&#39;: False}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Then the <code>item</code> transforms:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tfm_info</span><span class="p">[</span><span class="s1">&#39;after_item&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;RandomResizedCrop&#39;: {&#39;size&#39;: (460, 460),
  &#39;min_scale&#39;: 0.75,
  &#39;ratio&#39;: (1.0, 1.0),
  &#39;val_xtra&#39;: 0.14},
 &#39;ToTensor&#39;: {&#39;is_image&#39;: True}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And finally our batch transforms:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tfm_info</span><span class="p">[</span><span class="s1">&#39;after_batch&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;IntToFloatTensor&#39;: {&#39;div&#39;: 255.0, &#39;div_mask&#39;: 1},
 &#39;Normalize&#39;: {&#39;mean&#39;: array([[[[0.485]],
  
          [[0.456]],
  
          [[0.406]]]], dtype=float32),
  &#39;std&#39;: array([[[[0.229]],
  
          [[0.224]],
  
          [[0.225]]]], dtype=float32),
  &#39;axes&#39;: (0, 2, 3)}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Tabular">Tabular<a class="anchor-link" href="#Tabular"> </a></h2><p>Next we'll look at a tabular example. We will use the <code>ADULT_SAMPLE</code> dataset here:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">untar_data</span><span class="p">(</span><span class="n">URLs</span><span class="o">.</span><span class="n">ADULT_SAMPLE</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="o">/</span><span class="s1">&#39;adult.csv&#39;</span><span class="p">)</span>
<span class="n">splits</span> <span class="o">=</span> <span class="n">RandomSplitter</span><span class="p">()(</span><span class="n">range_of</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
<span class="n">cat_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;workclass&#39;</span><span class="p">,</span> <span class="s1">&#39;education&#39;</span><span class="p">,</span> <span class="s1">&#39;marital-status&#39;</span><span class="p">,</span> <span class="s1">&#39;occupation&#39;</span><span class="p">,</span> <span class="s1">&#39;relationship&#39;</span><span class="p">,</span> <span class="s1">&#39;race&#39;</span><span class="p">]</span>
<span class="n">cont_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;fnlwgt&#39;</span><span class="p">,</span> <span class="s1">&#39;education-num&#39;</span><span class="p">]</span>
<span class="n">procs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Categorify</span><span class="p">,</span> <span class="n">FillMissing</span><span class="p">,</span> <span class="n">Normalize</span><span class="p">]</span>
<span class="n">y_names</span> <span class="o">=</span> <span class="s1">&#39;salary&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">to</span> <span class="o">=</span> <span class="n">TabularPandas</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">procs</span><span class="o">=</span><span class="n">procs</span><span class="p">,</span> <span class="n">cat_names</span><span class="o">=</span><span class="n">cat_names</span><span class="p">,</span> <span class="n">cont_names</span><span class="o">=</span><span class="n">cont_names</span><span class="p">,</span>
                   <span class="n">y_names</span><span class="o">=</span><span class="n">y_names</span><span class="p">,</span> <span class="n">splits</span><span class="o">=</span><span class="n">splits</span><span class="p">)</span>
<span class="n">dls</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">dataloaders</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls</span><span class="o">.</span><span class="n">normalize</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Normalize -- {&#39;means&#39;: {&#39;age&#39;: 38.52497216783754, &#39;fnlwgt&#39;: 189756.69177319668, &#39;education-num&#39;: 10.091481438826827}, &#39;stds&#39;: {&#39;age&#39;: 13.633111349975714, &#39;fnlwgt&#39;: 105165.09125395071, &#39;education-num&#39;: 2.5544176335877404}}:
(Tabular,object) -&gt; encodes
(TensorImage,object) -&gt; encodes
 (Tabular,object) -&gt; decodes
(TensorImage,object) -&gt; decodes</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The usage is the exact same:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tfm_dicts</span> <span class="o">=</span> <span class="n">get_information</span><span class="p">(</span><span class="n">dls</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>However our keys are different. By default it will have <code>normalize</code>, <code>fill_missing</code>, and <code>categorify</code>, and then depending on what is available it will store either <code>categorize</code> or <code>regression_setup</code> to tell us about our outputs.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Here is an example from <code>Normalize</code>:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tfm_dicts</span><span class="p">[</span><span class="s1">&#39;Normalize&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;means&#39;: {&#39;age&#39;: 38.579446427885905,
  &#39;fnlwgt&#39;: 189089.21129409957,
  &#39;education-num&#39;: 10.079273676532688},
 &#39;stds&#39;: {&#39;age&#39;: 13.668500198858403,
  &#39;fnlwgt&#39;: 105206.02215862622,
  &#39;education-num&#39;: 2.5518035837225304}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>FillMissing</code>:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tfm_dicts</span><span class="p">[</span><span class="s1">&#39;FillMissing&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;fill_strategy&#39;: &#39;median&#39;,
 &#39;add_col&#39;: True,
 &#39;fill_vals&#39;: {&#39;education-num&#39;: 0},
 &#39;na_dict&#39;: {&#39;education-num&#39;: 10.0}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And <code>Categorify</code>:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tfm_dicts</span><span class="p">[</span><span class="s1">&#39;Categorify&#39;</span><span class="p">][</span><span class="s1">&#39;classes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>dict_keys([&#39;workclass&#39;, &#39;education&#39;, &#39;marital-status&#39;, &#39;occupation&#39;, &#39;relationship&#39;, &#39;race&#39;, &#39;education-num_na&#39;])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Before finally <code>categorize</code> (since we have a classification problem):</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tfm_dicts</span><span class="p">[</span><span class="s1">&#39;Categorize&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;vocab&#39;: [&#39;&lt;50k&#39;, &#39;&gt;=50k&#39;], &#39;add_na&#39;: False}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Exporting">Exporting<a class="anchor-link" href="#Exporting"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To export, a new <code>to_fastinference</code> function has been made</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Learner.to_fastinference" class="doc_header"><code>Learner.to_fastinference</code><a href="https://github.com/muellerzr/fastinference/tree/master/fastinference/inference/export.py#L87" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>Learner.to_fastinference</code>(<strong><code>x</code></strong>:<code>Learner</code>, <strong><code>data_fname</code></strong>=<em><code>'data'</code></em>, <strong><code>model_fname</code></strong>=<em><code>'model'</code></em>, <strong><code>path</code></strong>=<em><code>Path('.')</code></em>)</p>
</blockquote>
<p>Export data for <code>fastinference_onnx</code> or <code>_pytorch</code> to use</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">doc</span><span class="p">(</span><span class="n">Learner</span><span class="o">.</span><span class="n">to_fastinference</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Params:</p>
<ul>
<li><code>data_fname</code>: Filename to save our extracted <code>DataLoader</code> information, default is <code>data</code></li>
<li><code>model_fname</code>: Filename to save our current model, default is <code>model</code></li>
<li><code>path</code>: Path to save our model and data to, default is <code>.</code></li>
</ul>
<p>Exported files will have the extension <code>.pkl</code></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span> <span class="o">=</span> <span class="n">tabular_learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">accuracy</span><span class="p">])</span>
<span class="n">learn</span><span class="o">.</span><span class="n">to_fastinference</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;../../&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Simply call <code>learn.to_fastinference</code> and it will export everything needed for <code>fastinference_pytorch</code> or <code>fastinference_onnx</code></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">to_fastinference</span><span class="p">(</span><span class="n">data_fname</span> <span class="o">=</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">model_fname</span> <span class="o">=</span> <span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

